"use strict";var WebKCS=(()=>{var T=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames,X=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Z=(o,t,s)=>t in o?T(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s,te=(o,t)=>{for(var s in t||(t={}))ee.call(t,s)&&Z(o,s,t[s]);if(X)for(var s of X(t))ke.call(t,s)&&Z(o,s,t[s]);return o};var ve=(o,t)=>{for(var s in t)T(o,s,{get:t[s],enumerable:!0})},Te=(o,t,s,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Pe(t))!ee.call(o,i)&&i!==s&&T(o,i,{get:()=>t[i],enumerable:!(a=be(t,i))||a.enumerable});return o};var we=o=>Te(T({},"__esModule",{value:!0}),o);var Ve={};ve(Ve,{Client:()=>z});var r=class{constructor({name:t,type:s,protobufPayloadPath:a=void 0,responseName:i=void 0,assert:l=void 0}){this.name=t,this.type=s,this.protobufPayloadPath=a,this.responseName=i,this.assert=l}needId(){return this.type===0||this.type===1}};var e=function(...o){return t=>{e.skip=!1;for(let s of o){let a=s(t);if(e.skip&&t===void 0)break;t=a}return e.skip=!1,t}};e.skip=!1;e.subKey=[];e.TypeOf=function(o,t=o){return s=>{if(typeof s!==o)throw new e.Exception("Not a "+t)}};e.String=function(o){return o!=null||(o=""),e.TypeOf("string")(o),o};e.Float=function(o){return o!=null||(o=0),e.TypeOf("number","float")(o),o};e.Boolean=function(o){return o!=null||(o=!1),e.TypeOf("boolean")(o),o};e.Array=function(o){if(o!=null||(o=[]),typeof o!="object"||!(o instanceof Array))throw new e.Exception("Not an array");return o};e.Object=function(o){if(o!=null||(o={}),typeof o!="object"||o instanceof Array)throw new e.Exception("Not an object");return o};e.Date=function(o){if(o!=null||(o=new Date(0)),!(o instanceof Date))throw new e.Exception("Not a Date");return o};e.Int=function(o){if(o!=null||(o=0),e.TypeOf("number","int")(o),parseInt(o)!==o)throw new e.Exception("Not a int");return o};e.UInt=function(o){try{if(o=e.Int(o),o<0)throw null;return o}catch(t){throw new e.Exception("Not a uint")}};e.Optional=function(o){return typeof o>"u"&&(e.skip=!0),o};e.key=function(o,...t){return s=>{var a;s=e.Object(s),e.subKey.push(o);try{let i=e(...t)((a=s[o])!=null?a:void 0);i!==void 0&&(s[o]=i)}finally{e.subKey.pop()}return s}};e.arrayOf=function(...o){return t=>{e.Array(t);let s=e(...o);for(let a in t)t[a]=s(t[a]);return t}};e.valueIn=function(o){return o instanceof Array||(o=Object.values(o)),t=>{if(t!=null||(t=o[0]),!o.includes(t))throw new e.Exception("Not in possible values");return t}};e.oneOf=function(o){return t=>{t=e.Object(t);let s=0;for(let a of Object.getOwnPropertyNames(o)){if(t[a]===void 0)continue;let i=o[a];try{t[a]=i(t[a]),s++}catch(l){}}if(s===1)return t;throw s===0?new e.Exception("None of assert list is valid"):new e.Exception("Too much valid value: "+s)}};e.map=function(o,t){return s=>{s=e.Object(s);for(let a of Object.keys(s)){let i=""+parseInt(a)===a?parseInt(a):a;o(i),t(s[i])}return s}};e.Exception=class{constructor(o){this._message=o,this.subKey=Array.from(e.subKey)}get message(){return this.toString()}toString(){return this.keyName+": "+this._message}get keyName(){let o="value",t=this.subKey.join(".");return o+(t.length>0?"."+t:"")}};var H=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.LOBBY=1]="LOBBY",i[i.IN_PROGRESS=2]="IN_PROGRESS",i[i.ENDED=3]="ENDED",i))(H||{}),B=(s=>(s[s.DISABLED=0]="DISABLED",s[s.ENABLED=1]="ENABLED",s))(B||{}),W=(a=>(a[a.UNKNOWN=0]="UNKNOWN",a[a.ALERT=1]="ALERT",a[a.TOAST=2]="TOAST",a))(W||{}),V=(a=>(a[a.UNKNOWN=0]="UNKNOWN",a[a.CATALOG=1]="CATALOG",a[a.COMMUNITY=2]="COMMUNITY",a))(V||{}),G=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.CATALOG=1]="CATALOG",s))(G||{}),j=(y=>(y[y.UNKNOWN=0]="UNKNOWN",y[y.GENERAL=1]="GENERAL",y[y.MICROPHONE=2]="MICROPHONE",y[y.WAITING_MUSIC=3]="WAITING_MUSIC",y[y.BACKING_VOCAL=4]="BACKING_VOCAL",y[y.LEAD_VOCAL_A=5]="LEAD_VOCAL_A",y[y.LEAD_VOCAL_B=6]="LEAD_VOCAL_B",y))(j||{}),w=(s=>(s[s.UNKONWN=0]="UNKONWN",s[s.FREE_FOR_ALL=1]="FREE_FOR_ALL",s))(w||{}),F=(p=>(p[p.UNKNOWN=0]="UNKNOWN",p[p.IDLE=1]="IDLE",p[p.LOADING=2]="LOADING",p[p.READY=3]="READY",p[p.PLAY=4]="PLAY",p[p.PAUSE=5]="PAUSE",p))(F||{}),K=(a=>(a[a.UNKNOWN=0]="UNKNOWN",a[a.DEFAULT=1]="DEFAULT",a[a.ADMIN=2]="ADMIN",a))(K||{});var n={};n.Capacities=e(e.key("allSingerRotationGroupsQueueForAdmins",e.valueIn(B)));n.Notification=e(e.key("display",e.valueIn(W)),e.key("message",e.String));n.SongIdentifier=e(e.key("type",e.valueIn(V)),e.key("id",e.UInt));n.QuizIdentifier=e(e.key("type",e.valueIn(G)),e.key("id",e.UInt));n.Color=e(e.key("red",e.UInt),e.key("green",e.UInt),e.key("blue",e.UInt),e.key("alpha",e.Optional,e.UInt));n.Group=e(e.key("id",e.String),e.key("name",e.String),e.key("remoteIds",e.arrayOf(e.String)));n.TrackType=e.valueIn(j);n.Track=e(e.key("type",n.TrackType),e.key("caption",e.Optional,e.String),e.key("color",e.Optional,n.Color));n.TrackVolume=e(e.key("track",n.Track),e.key("volume",e.UInt));n.SongModBattle=e(e.key("subtype",e.valueIn(w)));n.SongModData=e(e.oneOf({battle:n.SongModBattle}));n.SongMod=e(e.key("id",e.UInt),e.key("caption",e.String),e.key("data",n.SongModData));n.SongOptions=e(e.key("singer",e.Optional,e.String),e.key("tempo",e.Optional,e.Int),e.key("pitch",e.Optional,e.Int),e.key("tracks",e.Optional,e.arrayOf(n.TrackVolume)),e.key("mod",e.Optional,n.SongMod));n.QueueItemSingerRotation=e(e.key("groupId",e.String),e.key("unbound",e.Boolean));n.QueueSong=e(e.key("id",n.SongIdentifier),e.key("title",e.String),e.key("artist",e.String),e.key("songTracks",e.arrayOf(n.Track)),e.key("options",e.Optional,n.SongOptions));n.QueueQuiz=e(e.key("id",n.QuizIdentifier),e.key("title",e.String),e.key("description",e.String));n.QueueItem=e(e.key("id",e.String),e.key("singerRotation",e.Optional,n.QueueItemSingerRotation),e.oneOf({song:n.QueueSong,quiz:n.QueueQuiz}));n.Queue=e(e.key("items",e.arrayOf(n.QueueItem)));n.UserActivity=e(e.key("remoteId",e.Optional,e.String),e.key("enrolled",e.Boolean),e.key("teamId",e.Optional,e.String));n.ActivityTeam=e(e.key("id",e.String),e.key("name",e.String),e.key("color",n.Color));n.Activity=e(e.key("state",e.valueIn(H)),e.key("canEnroll",e.Boolean),e.key("canWithdraw",e.Boolean),e.key("teams",e.arrayOf(n.ActivityTeam)));n.Status=e(e.key("state",e.valueIn(F)),e.key("tempo",e.Optional,e.Int),e.key("pitch",e.Optional,e.Int),e.key("tracks",e.arrayOf(n.TrackVolume)),e.key("current",e.Optional,n.QueueItem),e.key("activity",e.Optional,n.Activity));n.UserRole=e.valueIn(K);n.User=e(e.key("id",e.String),e.key("remoteId",e.String),e.key("name",e.String),e.key("role",n.UserRole));n.Permissions=e(e.key("manageQueue",e.Optional,e.Boolean),e.key("viewQueue",e.Optional,e.Boolean),e.key("addToQueue",e.Optional,e.Boolean),e.key("managePlayback",e.Optional,e.Boolean),e.key("manageVolumes",e.Optional,e.Boolean),e.key("sendPhotos",e.Optional,e.Boolean));n.Preferences=e(e.key("askOptions",e.Optional,e.Boolean),e.key("singerRotation",e.Optional,e.Boolean));n.CompatibleMods=e(e.key("battle",e.arrayOf(e.valueIn(w))));n.Configuration=e(e.key("pitchStep",e.Optional,e.UInt),e.key("tempoStep",e.Optional,e.UInt),e.key("pitchMin",e.Optional,e.Int),e.key("tempoMin",e.Optional,e.Int),e.key("pitchMax",e.Optional,e.Int),e.key("tempoMax",e.Optional,e.Int),e.key("compatibleMods",e.Optional,n.CompatibleMods));n.SessionApp=e(e.key("token",e(e.key("uid",e.String),e.key("_role",e.String),e.key("poolId",e.String),e.key("language",e.String),e.key("deviceName",e.String))));n.SessionRemote=e(e.key("token",e(e.key("uid",e.String),e.key("_role",e.String),e.key("sessionId",e.String))),e.key("name",e.String),e.key("role",n.UserRole));n.Session=e(e.key("id",e.String),e.key("userId",e.Optional,e.UInt),e.key("app",n.SessionApp),e.key("remotes",e.arrayOf(n.SessionRemote)));n.Pool=e(e.key("id",e.String),e.key("activeSession",e.Optional,e.String),e.key("sessions",e.arrayOf(n.Session)));n.WatchedMessage=e(e.key("clientUid",e.String),e.key("way",e.valueIn({IN:"in",OUT:"out"})),e.key("messageName",e.String),e.key("payload",e.Object));n.BusinessSession=e(e.key("id",e.String),e.key("firstName",e.String),e.key("endDate",e.Date),e.key("language",e.Optional,e.String));n.QuizQuestionAnswer=e(e.key("answerId",e.UInt),e.key("color",n.Color));n.QuizQuestion=e(e.key("questionNumber",e.UInt),e.key("answers",e.arrayOf(n.QuizQuestionAnswer)));n.QuizSubquestion=e(e.key("subquestionNumber",e.UInt),e.key("startDateTime",e.Date));n.QuizUserSelection=e(e.key("answerId",e.UInt),e.key("subquestionNumber",e.UInt));n.QuizUserStats=e(e.key("score",e.UInt),e.key("rank",e.UInt),e.key("userId",e.Optional,e.String));n.Note=e(e.key("note",e.UInt),e.key("count",e.UInt));n.DetectedNotes=e(e.key("startTime",e.UInt),e.key("step",e.UInt),e.key("notes",e.arrayOf(n.Note)));n.DetectedTransients=e(e.key("times",e.arrayOf(e.UInt)));n.SingUserStats=e(e.key("score",e.UInt),e.key("rank",e.UInt),e.key("remoteId",e.Optional,e.String));var Ne=[new r({name:"activity.UserActivityUpdateEvent",type:2,protobufPayloadPath:"event.activity.userActivityUpdate",assert:e(e.key("users",e.arrayOf(n.UserActivity)))}),new r({name:"activity.UserListRequest",type:0,protobufPayloadPath:"request.activity.userList",responseName:"activity.UserListResponse"}),new r({name:"activity.UserQueryRequest",type:0,protobufPayloadPath:"request.activity.userQuery",responseName:"activity.UserQueryResponse",assert:e(e.key("remoteIds",e.arrayOf(e.String)))}),new r({name:"activity.EnrollRequest",type:0,protobufPayloadPath:"request.activity.enroll",responseName:"activity.EnrollResponse",assert:e(e.key("remoteId",e.Optional,e.String))}),new r({name:"activity.WithdrawRequest",type:0,protobufPayloadPath:"request.activity.withdraw",responseName:"activity.WithdrawResponse",assert:e(e.key("remoteId",e.Optional,e.String),e.key("teamId",e.Optional,e.String))}),new r({name:"activity.ResendActivityEventRequest",type:0,protobufPayloadPath:"request.activity.resendActivityEvent",responseName:"activity.ResendActivityEventResponse"}),new r({name:"activity.UserListResponse",type:1,protobufPayloadPath:"response.activity.userList",assert:e(e.key("users",e.arrayOf(n.UserActivity)))}),new r({name:"activity.UserQueryResponse",type:1,protobufPayloadPath:"response.activity.userQuery",assert:e(e.key("users",e.arrayOf(n.UserActivity)))}),new r({name:"activity.EnrollResponse",type:1,protobufPayloadPath:"response.activity.enroll"}),new r({name:"activity.WithdrawResponse",type:1,protobufPayloadPath:"response.activity.withdraw"}),new r({name:"activity.ResendActivityEventResponse",type:1,protobufPayloadPath:"response.activity.resendActivityEvent"})],se=Ne;var Oe=[new r({name:"auth.ProcessRemoteLoginRequest",type:0,protobufPayloadPath:"request.auth.processRemoteLogin",responseName:"auth.ProcessRemoteLoginResponse"}),new r({name:"auth.ProcessRemoteLoginResponse",type:1,protobufPayloadPath:"response.auth.processRemoteLogin"})],oe=Oe;var Ie=[new r({name:"backend.UpdateSessionRequest",type:0,responseName:"backend.UpdateSessionResponse",assert:e(e.key("sessionId",e.String),e.key("poolId",e.String),e.key("userId",e.Optional,e.UInt),e.key("allowRemote",e.Optional,e.Boolean),e.key("maxRemotes",e.Optional,e.UInt))}),new r({name:"backend.UpdateSessionResponse",type:1}),new r({name:"backend.CloseSessionRequest",type:0,responseName:"backend.CloseSessionResponse",assert:e(e.key("sessionId",e.String))}),new r({name:"backend.CloseSessionResponse",type:1}),new r({name:"backend.UpdateBusinessSessionRequest",type:0,responseName:"backend.UpdateBusinessSessionResponse",assert:e(e.key("poolId",e.String),e.key("current",e.Optional,n.BusinessSession),e.key("nextUpdate",e.Optional,e.Date))}),new r({name:"backend.UpdateBusinessSessionResponse",type:1}),new r({name:"backend.SendRemoteLoginReadyRequest",type:0,responseName:"backend.SendRemoteLoginReadyResponse",assert:e(e.key("sessionId",e.String))}),new r({name:"backend.SendRemoteLoginReadyResponse",type:1})],re=Ie;var m=class{constructor(t){this.message=t}getMessage(){return this.message}toString(){return this.message}};var R=class extends m{},N=class extends R{constructor(t){super(t.message),this.code=t.code}};var b=class extends m{constructor(t,s){super(s),this.code=t}};var u=class extends m{constructor(t,s){super(s),this.type=t}getErrorCode(){return this.type}};(t=>{let o;(d=>(d[d.UNKNOWN=0]="UNKNOWN",d[d.NOT_SUPPORTED=1]="NOT_SUPPORTED",d[d.SWITCH_URL_FAILED=2]="SWITCH_URL_FAILED",d[d.FORBIDDEN=3]="FORBIDDEN",d[d.BAD_CONTENT=4]="BAD_CONTENT",d[d.TARGET_UNREACHABLE=5]="TARGET_UNREACHABLE",d[d.CLOSED_CONNECTION=6]="CLOSED_CONNECTION",d[d.REQUEST_TIMEOUT=7]="REQUEST_TIMEOUT"))(o=t.Type||(t.Type={}))})(u||(u={}));var O=class extends m{};var Me=[new r({name:"core.PingRequest",type:0,protobufPayloadPath:"request.socket.ping",responseName:"core.PingResponse"}),new r({name:"core.PingResponse",type:1,protobufPayloadPath:"response.socket.ping"}),new r({name:"core.TimestampRequest",type:0,protobufPayloadPath:"request.socket.timestamp",responseName:"core.TimestampResponse"}),new r({name:"core.TimestampResponse",type:1,protobufPayloadPath:"response.socket.timestamp",assert:e(e.key("timestamp",e.Date))}),new r({name:"core.GetCapacitiesRequest",type:0,protobufPayloadPath:"request.socket.getCapacities",responseName:"core.GetCapacitiesResponse"}),new r({name:"core.GetCapacitiesResponse",type:1,protobufPayloadPath:"response.socket.getCapacities",assert:e(e.key("capacities",n.Capacities))}),new r({name:"Error",type:1,protobufPayloadPath:"response.error",assert:e(e.key("type",e.valueIn(u.Type)),e.key("message",e.String))}),new r({name:"core.AuthenticatedEvent",type:2,protobufPayloadPath:"event.socket.authenticatedEvent"}),new r({name:"core.NotificationEvent",type:2,protobufPayloadPath:"event.notification",assert:n.Notification})],ae=Me;var Ue=[new r({name:"remote.AppLeftEvent",type:2,protobufPayloadPath:"event.remote.lastPlayerLeft"}),new r({name:"remote.AppJoinEvent",type:2,protobufPayloadPath:"event.remote.playerJoin"})],ie=Ue;var qe=[new r({name:"remote.BackgroundEvent",type:2,protobufPayloadPath:"event.player.background",assert:e(e.key("color",n.Color))})],pe=qe;var Ce=[new r({name:"business.SessionRequest",type:0,protobufPayloadPath:"request.business.session",responseName:"business.SessionResponse",assert:e(e.key("session",e.Optional,n.BusinessSession))}),new r({name:"business.SessionResponse",type:1,protobufPayloadPath:"response.business.session"})],ue=Ce;var Ae=[new r({name:"remote.SendPhotoRequest",type:0,protobufPayloadPath:"request.social.sendPhoto",responseName:"remote.SendPhotoResponse",assert:e(e.key("url",e.String))}),new r({name:"remote.SendPhotoResponse",type:1,protobufPayloadPath:"response.social.sendPhoto"})],le=Ae;var xe=[new r({name:"remote.QueueEvent",type:2,protobufPayloadPath:"event.player.queue",assert:e(e.key("queue",n.Queue))}),new r({name:"remote.QueueRequest",type:0,protobufPayloadPath:"request.player.queue",responseName:"remote.QueueResponse"}),new r({name:"remote.AddToQueueRequest",type:0,protobufPayloadPath:"request.player.addToQueue",responseName:"remote.AddToQueueResponse",assert:e(e.oneOf({song:n.SongIdentifier,quiz:n.QuizIdentifier}),e.key("position",e.Optional,e.UInt),e.key("options",e.Optional,n.SongOptions),e.key("remoteId",e.Optional,e.String))}),new r({name:"remote.RemoveFromQueueRequest",type:0,protobufPayloadPath:"request.player.removeFromQueue",responseName:"remote.RemoveFromQueueResponse",assert:e(e.key("queueItemId",e.String))}),new r({name:"remote.MoveInQueueRequest",type:0,protobufPayloadPath:"request.player.moveQueue",responseName:"remote.MoveInQueueResponse",assert:e(e.key("queueItemId",e.String),e.key("to",e.UInt))}),new r({name:"remote.SetQueueItemOptionsRequest",type:0,protobufPayloadPath:"request.player.setQueueItemOptions",responseName:"remote.SetQueueItemOptionsResponse",assert:e(e.key("queueItemId",e.String),e.key("options",n.SongOptions))}),new r({name:"remote.QueueResponse",type:1,protobufPayloadPath:"response.player.queue",assert:e(e.key("queue",n.Queue))}),new r({name:"remote.AddToQueueResponse",type:1,protobufPayloadPath:"response.player.addToQueue"}),new r({name:"remote.RemoveFromQueueResponse",type:1,protobufPayloadPath:"response.player.removeFromQueue"}),new r({name:"remote.MoveInQueueResponse",type:1,protobufPayloadPath:"response.player.moveQueue"}),new r({name:"remote.SetQueueItemOptionsResponse",type:1,protobufPayloadPath:"response.player.setQueueItemOptions"})],ye=xe;var Qe=[new r({name:"quiz.ReadySceneEvent",type:2,protobufPayloadPath:"event.quiz.readyScene"}),new r({name:"quiz.QuestionSceneEvent",type:2,protobufPayloadPath:"event.quiz.questionScene",assert:e(e.key("question",n.QuizQuestion),e.key("subquestions",e.arrayOf(n.QuizSubquestion)),e.key("userSelection",e.Optional,n.QuizUserSelection))}),new r({name:"quiz.RightAnswerSceneEvent",type:2,protobufPayloadPath:"event.quiz.rightAnswerScene",assert:e(e.key("question",n.QuizQuestion),e.key("rightAnswerId",e.UInt),e.key("userSelection",e.Optional,n.QuizUserSelection),e.key("canStartInterlude",e.Boolean))}),new r({name:"quiz.RankingSceneEvent",type:2,protobufPayloadPath:"event.quiz.rankingScene",assert:e(e.key("stats",e.arrayOf(n.QuizUserStats)),e.key("canStartInterlude",e.Boolean))}),new r({name:"quiz.EndSceneEvent",type:2,protobufPayloadPath:"event.quiz.endScene",assert:e(e.key("stats",e.arrayOf(n.QuizUserStats)))}),new r({name:"quiz.InterludeSceneEvent",type:2,protobufPayloadPath:"event.quiz.interludeScene"}),new r({name:"quiz.StatsUpdateEvent",type:2,protobufPayloadPath:"event.quiz.statsUpdate",assert:e(e.key("stats",n.QuizUserStats))}),new r({name:"quiz.UserAnswerRequest",type:0,protobufPayloadPath:"request.quiz.userAnswer",responseName:"quiz.UserAnswerResponse",assert:e(e.key("userId",e.Optional,e.String),e.key("questionNumber",e.UInt),e.key("selection",n.QuizUserSelection))}),new r({name:"quiz.GetStatsRequest",type:0,protobufPayloadPath:"request.quiz.getStats",responseName:"quiz.GetStatsResponse",assert:e(e.key("userIds",e.arrayOf(e.String)))}),new r({name:"quiz.ResendSceneEventRequest",type:0,protobufPayloadPath:"request.quiz.resendSceneEvent",responseName:"quiz.ResendSceneEventResponse"}),new r({name:"quiz.StartInterludeRequest",type:0,protobufPayloadPath:"request.quiz.startInterlude",responseName:"quiz.StartInterludeResponse"}),new r({name:"quiz.StopInterludeRequest",type:0,protobufPayloadPath:"request.quiz.stopInterlude",responseName:"quiz.StopInterludeResponse"}),new r({name:"quiz.UserAnswerResponse",type:1,protobufPayloadPath:"response.quiz.userAnswer"}),new r({name:"quiz.GetStatsResponse",type:1,protobufPayloadPath:"response.quiz.getStats",assert:e(e.key("stats",e.arrayOf(n.QuizUserStats)))}),new r({name:"quiz.ResendSceneEventResponse",type:1,protobufPayloadPath:"response.quiz.resendSceneEvent"}),new r({name:"quiz.StartInterludeResponse",type:1,protobufPayloadPath:"response.quiz.startInterlude"}),new r({name:"quiz.StopInterludeResponse",type:1,protobufPayloadPath:"response.quiz.stopInterlude"})],ce=Qe;var Le=[new r({name:"sing.SangDataEvent",type:2,protobufPayloadPath:"event.sing.sangData",assert:e(e.key("detectedNotes",n.DetectedNotes),e.key("detectedTransients",n.DetectedTransients),e.key("remoteId",e.Optional,e.String))}),new r({name:"sing.SongStartEvent",type:2,protobufPayloadPath:"event.sing.songStart",assert:e(e.key("startDateTime",e.Date))}),new r({name:"sing.SongEndEvent",type:2,protobufPayloadPath:"event.sing.songEnd",assert:e(e.key("stats",e.arrayOf(n.SingUserStats)))}),new r({name:"sing.SongReadyEvent",type:2,protobufPayloadPath:"event.sing.songReady"})],de=Le;var De=[new r({name:"player.GroupsEvent",type:2,protobufPayloadPath:"event.player.groups",assert:e(e.key("groups",e.arrayOf(n.Group)))}),new r({name:"player.GetGroupsRequest",type:0,protobufPayloadPath:"request.player.groups",responseName:"player.GetGroupsResponse"}),new r({name:"player.GetGroupsResponse",type:1,protobufPayloadPath:"response.player.groups",assert:e(e.key("groups",e.arrayOf(n.Group)))})],me=De;var _e=[new r({name:"remote.StatusEvent",type:2,protobufPayloadPath:"event.player.status",assert:e(e.key("status",n.Status))}),new r({name:"remote.StatusRequest",type:0,protobufPayloadPath:"request.player.status",responseName:"remote.StatusResponse"}),new r({name:"remote.PlayRequest",type:0,protobufPayloadPath:"request.player.play",responseName:"remote.PlayResponse"}),new r({name:"remote.PauseRequest",type:0,protobufPayloadPath:"request.player.pause",responseName:"remote.PauseResponse"}),new r({name:"remote.NextRequest",type:0,protobufPayloadPath:"request.player.next",responseName:"remote.NextResponse"}),new r({name:"remote.PitchRequest",type:0,protobufPayloadPath:"request.player.pitch",responseName:"remote.PitchResponse",assert:e(e.key("pitch",e.Int))}),new r({name:"remote.TempoRequest",type:0,protobufPayloadPath:"request.player.tempo",responseName:"remote.TempoResponse",assert:e(e.key("tempo",e.Int))}),new r({name:"remote.TrackVolumeRequest",type:0,protobufPayloadPath:"request.player.trackVolume",responseName:"remote.TrackVolumeResponse",assert:e(e.key("type",n.TrackType),e.key("volume",e.UInt))}),new r({name:"remote.SongModRequest",type:0,protobufPayloadPath:"request.player.songMod",responseName:"remote.SongModResponse",assert:e(e.key("id",e.UInt))}),new r({name:"remote.StatusResponse",type:1,protobufPayloadPath:"response.player.status",assert:e(e.key("status",n.Status))}),new r({name:"remote.PlayResponse",type:1,protobufPayloadPath:"response.player.play"}),new r({name:"remote.PauseResponse",type:1,protobufPayloadPath:"response.player.pause"}),new r({name:"remote.NextResponse",type:1,protobufPayloadPath:"response.player.next"}),new r({name:"remote.PitchResponse",type:1,protobufPayloadPath:"response.player.pitch"}),new r({name:"remote.TempoResponse",type:1,protobufPayloadPath:"response.player.tempo"}),new r({name:"remote.TrackVolumeResponse",type:1,protobufPayloadPath:"response.player.trackVolume"}),new r({name:"remote.SongModResponse",type:1,protobufPayloadPath:"response.player.songMod"})],fe=_e;var ze=[new r({name:"remote.UserJoinEvent",type:2,protobufPayloadPath:"event.remote.userJoined",assert:e(e.key("user",n.User))}),new r({name:"remote.UserLeftEvent",type:2,protobufPayloadPath:"event.remote.userLeft",assert:e(e.key("userId",e.String))}),new r({name:"remote.UserUpdateEvent",type:2,protobufPayloadPath:"event.remote.userUpdate",assert:e(e.key("user",n.User))}),new r({name:"remote.PermissionsUpdateEvent",type:2,protobufPayloadPath:"event.remote.permissionsUpdate",assert:e(e.key("permissions",n.Permissions))}),new r({name:"remote.PreferencesUpdateEvent",type:2,protobufPayloadPath:"event.remote.preferencesUpdate",assert:e(e.key("preferences",n.Preferences))}),new r({name:"remote.ConfigurationUpdateEvent",type:2,protobufPayloadPath:"event.remote.configurationUpdate",assert:e(e.key("configuration",n.Configuration))}),new r({name:"remote.UsernameUpdateEvent",type:2,protobufPayloadPath:"event.remote.usernameUpdate",assert:e(e.key("username",e.String))}),new r({name:"remote.UpdateUsernameRequest",type:0,protobufPayloadPath:"request.remote.usernameUpdate",responseName:"remote.UpdateUsernameResponse",assert:e(e.key("username",e.String))}),new r({name:"remote.UserListRequest",type:0,protobufPayloadPath:"request.remote.userList",responseName:"remote.UserListResponse"}),new r({name:"remote.GetPermissionsRequest",type:0,protobufPayloadPath:"request.remote.getPermissions",responseName:"remote.GetPermissionsResponse"}),new r({name:"remote.SetPermissionsRequest",type:0,protobufPayloadPath:"request.remote.setPermissions",responseName:"remote.SetPermissionsResponse",assert:e(e.key("permissions",n.Permissions))}),new r({name:"remote.SetRoleRequest",type:0,protobufPayloadPath:"request.remote.setRole",responseName:"remote.SetRoleResponse",assert:e(e.key("userId",e.String),e.key("role",n.UserRole))}),new r({name:"remote.GetPreferencesRequest",type:0,protobufPayloadPath:"request.remote.getPreferences",responseName:"remote.GetPreferencesResponse"}),new r({name:"remote.SetPreferencesRequest",type:0,protobufPayloadPath:"request.remote.setPreferences",responseName:"remote.SetPreferencesResponse",assert:e(e.key("preferences",n.Preferences))}),new r({name:"remote.GetConfigurationRequest",type:0,protobufPayloadPath:"request.remote.getConfiguration",responseName:"remote.GetConfigurationResponse"}),new r({name:"remote.UpdateUsernameResponse",type:1,protobufPayloadPath:"response.remote.usernameUpdate"}),new r({name:"remote.UserListResponse",type:1,protobufPayloadPath:"response.remote.userList",assert:e(e.key("users",e.arrayOf(n.User)))}),new r({name:"remote.GetPermissionsResponse",type:1,protobufPayloadPath:"response.remote.getPermissions",assert:e(e.key("permissions",n.Permissions))}),new r({name:"remote.SetPermissionsResponse",type:1,protobufPayloadPath:"response.remote.setPermissions"}),new r({name:"remote.SetRoleResponse",type:1,protobufPayloadPath:"response.remote.setRole"}),new r({name:"remote.GetPreferencesResponse",type:1,protobufPayloadPath:"response.remote.getPreferences",assert:e(e.key("preferences",n.Preferences))}),new r({name:"remote.SetPreferencesResponse",type:1,protobufPayloadPath:"response.remote.setPreferences"}),new r({name:"remote.GetConfigurationResponse",type:1,protobufPayloadPath:"response.remote.getConfiguration",assert:e(e.key("configuration",n.Configuration))})],ge=ze;var He=[new r({name:"monitor.PoolListRequest",type:0,responseName:"monitor.PoolListResponse"}),new r({name:"monitor.PoolListResponse",type:1,assert:e(e.key("pools",e.arrayOf(n.Pool)))}),new r({name:"monitor.PoolUpdateEvent",type:2,assert:e(n.Pool)}),new r({name:"monitor.PoolDeleteEvent",type:2,assert:e(e.key("poolId",e.String))}),new r({name:"monitor.MessageWatchRequest",type:0,responseName:"monitor.MessageWatchResponse",assert:e(e.key("filter",e.oneOf({poolId:e.String,sessionId:e.String})))}),new r({name:"monitor.MessageWatchResponse",type:1}),new r({name:"monitor.MessageWatchEvent",type:2,assert:e(n.WatchedMessage)}),new r({name:"monitor.MessageUnwatchRequest",type:0,responseName:"monitor.MessageUnwatchResponse"}),new r({name:"monitor.MessageUnwatchResponse",type:1})],he=He;var Be=[new r({name:"uptime.UpRequest",type:0,responseName:"uptime.UpResponse"}),new r({name:"uptime.UpResponse",type:1})],Ee=Be;var Se=[].concat(se,oe,re,ae,ie,pe,ue,le,ye,ce,de,me,fe,ge,he,Ee);var We="Error",f=new class{constructor(o){this.typeList=[];for(let t of o)this.appendMessageType(t)}appendMessageType(o){this.typeList.push(o)}getByName(o){for(let t of this.typeList)if(t.name===o)return t;return null}getErrorType(){return this.getByName(We)}getResponseTypeForRequest(o){return o.responseName===void 0?null:this.getByName(o.responseName)}getAll(){return this.typeList}}(Se);var E=class{constructor(t,s,a){this.type=t,this.payload=s,this.id=a}isRequest(){return this.type.type===0}isResponse(){return this.type.type===1}isEvent(){return this.type.type===2}};var I=class{constructor(t,s){this.resolver=t,this.rejector=s,this._isResolved=!1}get isResolved(){return this._isResolved}resolve(t=null){this._isResolved=!0,this.resolver(t)}reject(t=null){this._isResolved=!0,this.rejector(t)}},M=class extends I{constructor(t,s,a,i){super(s,a),this.responseTypeName=t.responseName,this.timeoutID=setTimeout(()=>{this.reject(new u(u.Type.REQUEST_TIMEOUT,"Request has timed out"))},i)}resolve(t=null){clearTimeout(this.timeoutID),super.resolve(t)}reject(t=null){clearTimeout(this.timeoutID),super.reject(t)}},U=class{constructor(){this.promise=new Promise((t,s)=>this.resolver=new I(t,s))}get isResolved(){return this.resolver.isResolved}resolve(t=null){this.resolver.resolve(t)}reject(t=null){this.resolver.reject(t)}};var q=class{constructor({type:t,content:s}){this.type=t,this.content=s}},C=class{constructor({name:t,data:s}){this.name=t,this.data=s}},A=class{constructor({type:t,content:s}){this.type=t,this.content=s}};var Y=new class{validate(t){let s=t.type;s.assert&&(t.payload=s.assert(t.payload))}};var h=class{constructor(){this.internalList=new Array}call(...t){for(let s of this.internalList)s(...t)}addHandler(t){this.internalList.push(t)}removeHandler(t){let s=new Array;for(let a of this.internalList)t!==a&&s.push(a);this.internalList=s}};var x=class x{constructor(t){this._requestResolver=new Map;this.state=0;this._id=0;this.openHandlers=new h;this.authenticatedHandlers=new h;this.readyHandlers=new h;this.closeHandlers=new h;this._requestHandler=new Map;this._eventHandler=new Map;this._verifyMessageFormat=!0;this.closeRequested=!1;this.closePromise=Promise.resolve({code:4e3}),this.updateInternalTransport(t),this.defineInternalHandler()}send(t,s={}){let a=f.getByName(t);if(!a||a.type!==0)throw new m("Unknown request type: "+t);let i=++this._id,l=new Promise((p,y)=>{let v=new M(a,p,y,x.requestTimeoutMs);this._requestResolver.set(i,v);try{this.sendMessage(a,s,i)}catch(Re){v.reject(Re)}});return l.catch(()=>this._requestResolver.delete(i)),l}sendEvent(t,s){let a=f.getByName(t);if(!a||a.type!==2)throw new m("Unknown event type: "+t);this.sendMessage(a,s)}addRequestHandler(t,s){this._requestHandler.set(t,s)}addEventHandler(t,s){this._eventHandler.set(t,s)}addOpenHandler(t){this.openHandlers.addHandler(t)}addAuthenticatedHandler(t){this.authenticatedHandlers.addHandler(t)}addReadyHandler(t){this.readyHandlers.addHandler(t)}setErrorHandler(t){this.errorHandler=t}addCloseHandler(t){this.closeHandlers.addHandler(t)}disableVerifyMessageFormat(){this._verifyMessageFormat=!1}setWatchNotifier(t){this.notifier=t}get isClosed(){return this.state==0}get isOpened(){return this.state>=1}get isAuthenticated(){return this.state>=2}get isReady(){return this.state>=3}hasCloseBeenRequested(){return this.closeRequested}onReceiveMessage(t){var s;if(this._verifyMessageFormat)try{Y.validate(t)}catch(a){this.sendErrorResponse(t,new u(u.Type.BAD_CONTENT,a.toString()));return}if((s=this.notifier)==null||s.notify("message",{way:"in",message:t}),t.isRequest()){this.onReceiveRequest(t);return}if(t.isResponse()){this.onReceiveResponse(t);return}if(t.isEvent()){this.onReceiveEvent(t);return}}async onReceiveRequest(t){let s=this._requestHandler.get(t.type.name);if(!s){this.sendErrorResponse(t,new u(u.Type.NOT_SUPPORTED,"No request handler for "+t.type.name));return}let a=null;try{let i=new q({type:t.type.name,content:t.payload}),p=s(i,v=>{if(a!==null)throw"An delayed callback is already defined";a=v}),y=p instanceof Promise?await p:p;this.sendResponse(t,y)}catch(i){let l=i;i instanceof b&&(i=new u(u.Type.CLOSED_CONNECTION,i.getMessage())),i instanceof u||(console.error(i),i=new u(u.Type.UNKNOWN,"Internal Error")),this.sendErrorResponse(t,i),l instanceof b&&await this.close(l.code,l.getMessage())}if(a!==null){let i=a();i instanceof Promise&&await i}}onReceiveResponse(t){let s=t.id;if(s===void 0||!this._requestResolver.has(s))return;let a=this._requestResolver.get(s);this._requestResolver.delete(s);let i=Object.assign({},t.payload);if(t.type===f.getErrorType()){a.reject(new u(i.type,i.message));return}if(a.responseTypeName!==t.type.name){let p='Expected Response type "'.concat(a.responseTypeName,'", Received "').concat(t.type.name,'"');a.reject(new u(u.Type.BAD_CONTENT,p));return}let l=new A({type:t.type.name,content:t.payload});a.resolve(l)}async onReceiveEvent(t){let s=this._eventHandler.get(t.type.name);if(!s)return;let a=new C({name:t.type.name,data:t.payload});await s(a)}sendResponse(t,s){let a=f.getResponseTypeForRequest(t.type);this.sendMessage(a,s,t.id)}sendErrorResponse(t,s){let a=f.getErrorType();this.sendMessage(a,{type:s.getErrorCode(),message:s.getMessage()},t.id)}sendMessage(t,s,a){var l;let i=new E(t,s,a);if((l=this.notifier)==null||l.notify("message",{way:"out",message:i}),this._verifyMessageFormat)try{Y.validate(i)}catch(p){throw new O(p.toString())}this.transport.sendMessage(i)}onClose(t){this.state=0,this.closeHandlers.call(t,this),this._closeResolver&&this._closeResolver(t),this.closeAllRequestByError(new u(u.Type.CLOSED_CONNECTION,"Connection closed during request - "+t.code+" - "+t.reason))}closeAllRequestByError(t){this._requestResolver.forEach((s,a)=>{this._requestResolver.delete(a),s.reject(t)})}onError(t){if(this.errorHandler){this.errorHandler(t);return}throw new R(t)}async close(t,s){return this.isClosed||(this.closeRequested=!0),this.transport.close({code:t,reason:s}),this.closePromise}async closed(){return this.closePromise}updateInternalTransport(t){t&&(this.transport=t),this.transport.onOpen(()=>this.onOpen()),this.transport.onClose(s=>this.onClose(s)),this.transport.messages().each(s=>this.onReceiveMessage(s)),this.transport.errors().each(s=>this.onError(s))}defineInternalHandler(){this.addEventHandler("core.AuthenticatedEvent",()=>this.onAuthenticated())}onOpen(){this.state=1,this.closeRequested=!1,this.closePromise=new Promise(t=>this._closeResolver=t),this.openHandlers.call()}onAuthenticated(){this.state=2,this.authenticatedHandlers.call(),this.state=3,this.readyHandlers.call()}};x.requestTimeoutMs=5e3;var g=x;(t=>t.EMULATED_PING_SUBPROTOCOL="+emuping")(g||(g={}));var S=null;typeof WebSocket<"u"?S=WebSocket:typeof MozWebSocket<"u"?S=MozWebSocket:typeof global<"u"?S=global.WebSocket||global.MozWebSocket:typeof window<"u"?S=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(S=self.WebSocket||self.MozWebSocket);var J=S;var Q=class o{constructor(t,s){this.openListener=()=>null;this.receiveDataListener=()=>null;this.closeListener=()=>null;this.errorListener=()=>null;this.beforeReconnectAttemptListener=()=>null;this.lostConnectionListener=()=>null;this.reconnectedListener=()=>null;this._reconnectRetries=0;this.reconnectInterval=5*1e3;this._pendingReconnect=!1;this.manuallyClosed=!1;this.socketCloseHandler=t=>this.handleSocketCloseEvent(t);this.webSocket=t,this.clientProtocol=s.protocol,this.registerWebSocket()}static fromAddress(t,s){return new o(new J(t,s.protocol),s)}registerWebSocket(){this.webSocket.binaryType="arraybuffer",this.webSocket.addEventListener("open",()=>this.handleSocketOpenEvent()),this.webSocket.addEventListener("message",t=>this.receiveDataListener(t.data)),this.webSocket.addEventListener("close",this.socketCloseHandler),this.webSocket.addEventListener("error",t=>this.errorListener(t))}handleSocketOpenEvent(){if(this.manuallyClosed=!1,this._reconnectRetries=0,this._pendingReconnect){console.debug("Calling reconnected listener"),this.reconnectedListener(),this._pendingReconnect=!1;return}this.openListener()}handleSocketCloseEvent(t){if(t.wasClean){this.closeListener(t.code,t.reason);return}if(!this.manuallyClosed){if(this._reconnectRetries++,this._reconnectRetries===1){console.debug("Trying transparent reconnect"),this.beforeReconnectAttemptListener(),this.reconnect();return}this._pendingReconnect||(console.debug("Calling lost connection listener"),this.beforeReconnectAttemptListener(),this.lostConnectionListener(),this._pendingReconnect=!0),console.debug("Reconnecting in ".concat(this.reconnectInterval/1e3,"s (try ").concat(this._reconnectRetries,")")),setTimeout(()=>this.reconnect(),this.reconnectInterval)}}async getUrl(){if(!this.urlProvider)return console.debug("No URL provider, using current URL"),this.webSocket.url;try{return await this.urlProvider()}catch(t){return console.error("URL provider failed, fallback with current URL",t),this.webSocket.url}}reconnect(){this.manuallyClosed||(console.log("Reconnecting\u2026"),this.open())}send(t){this.webSocket.send(t)}async open(){this.webSocket.readyState<=1||(this.codeClose=void 0,this.webSocket=new J(await this.getUrl(),this.clientProtocol),this.registerWebSocket())}close(t,s){if(!this.manuallyClosed){if(this.manuallyClosed=!0,this.webSocket.readyState>=2){this.closeListener(t,s);return}this.webSocket.close(t,s)}}timeout(){this.webSocket.readyState>=2||(console.log("Ping timeout, triggering close event\u2026"),this.webSocket.removeEventListener("close",this.socketCloseHandler),this.webSocket.close(4300),this.handleSocketCloseEvent({wasClean:!1,code:4300,reason:""}))}setCloseListener(t){this.closeListener=t}setErrorListener(t){this.errorListener=t}setDataListener(t){this.receiveDataListener=t}setLostConnectionListener(t){this.lostConnectionListener=t}setReconnectedListener(t){this.reconnectedListener=t}isClose(){return this.codeClose!==void 0}getCloseCode(){return this.codeClose}setUrlProvider(t){this.urlProvider=t}setBeforeReconnectAttemptListener(t){this.beforeReconnectAttemptListener=t}setOpenListener(t){this.openListener=t}get protocol(){return this.webSocket.protocol}get state(){return this.webSocket.readyState}};var $=new class{stringify(o){return JSON.stringify(this.encode(o))}parse(o){if(o===void 0)return;let t=JSON.parse(o);return this.needDecode(o)&&(t=this.decode(t)),t}encode(o){if(o instanceof Array)return o.map(s=>this.encode(s));if(o===null||typeof o!="object")return o;let t=te({},o);for(let s of Object.keys(o)){let a=t[s];if(a instanceof Date){t[s]={_type:"timestamp",value:a.toISOString()};continue}typeof a=="object"&&a!==null&&(t[s]=this.encode(a))}return t}decode(o){if(o===null||typeof o!="object")return o;if(o._type!==void 0&&o._type==="timestamp")return new Date(o.value);let t=Object.keys(o);for(let s of t)o[s]=this.decode(o[s]);return o}needDecode(o){return typeof o=="string"?o.includes("timestamp"):!1}};var L=class{get baseProtocol(){return"kcpj"}get protocol(){return"".concat(this.baseProtocol,"~v2")}get weightMultiplier(){return 2.5}decodeToMessage(t){try{let s=$.parse(t.toString()||t);return this.toMessage(s)}catch(s){return null}}encodeMessage(t){return $.stringify(this.formatMessage(t))}formatMessage(t){let s={};return t.id!==void 0&&(s.id=t.id),s.type=t.type.name,s.payload=t.payload,s}toMessage(t){if(typeof t!="object")throw new m("Message must be an object, actually "+typeof t);if(typeof t.type!="string")throw new m("Message must be have a type as string, actually "+typeof t.type);if(typeof t.payload!="object")throw new m("Message must be have a type as object, actually "+typeof t.payload);let s;t.id!==void 0&&(s=Number.isInteger(t.id)?t.id:String(t.id));let a=String(t.type),i=t.payload,l=f.getByName(a);if(!l)throw new m("Message have an unknown type: "+a);if(l.needId()&&s===void 0)throw new m("Message of type "+l.name+" must have an id");return new E(l,i,l.needId()?s:void 0)}};var P=class{constructor(){this.queue=[]}push(t){this.queue.push(t),this.dequeue()}each(t){this.forEachCallable=t,this.dequeue()}dequeue(){if(this.forEachCallable)for(;this.queue.length>0;){let t=this.queue.shift();this.forEachCallable(t)}}unbind(){this.forEachCallable=void 0}available(){return this.queue.length}};var k=class{constructor(t){this.upgrades=t;this.downgrades=[...t].reverse()}upgrade(t){for(let s of this.upgrades)t=s.upgrade(t);return t}downgrade(t){for(let s of this.downgrades)t=s.downgrade(t);return t}};var D=class{constructor(){this.upgrades=[]}addUpgrade(t){this.upgrades.push(t)}static getEmptyUpgrader(){return new k([])}getUpgraderForVersion(t){let s=[],a;for(;a=this.findUpgrade(t);)s.push(a),t=a.toVersion();return new k(s)}findUpgrade(t){return this.upgrades.find(s=>s.canUpgrade(t))}};var _=class{constructor({socket:t,formatter:s,upgrader:a}){this.messageQueue=new P;this.errorQueue=new P;this.openCallback=()=>null;this.closeCallback=()=>null;this.closePromise=new U;this.internalSocket=t,this.formatter=s,this.upgrader=a!=null?a:D.getEmptyUpgrader(),this.installSocketHandler()}receiveData(t){let s=this.formatter.decodeToMessage(t);if(!s){console.error("Receive bad format message",t);return}s=this.upgrader.upgrade(s),this.messageQueue.push(s)}openListener(){this.openCallback()}closeListener(t,s){this.closeCallback({code:t,reason:s}),this.closePromise.resolve()}close(t){return this.internalSocket.close(t.code,t.reason),this.closePromise.promise}messages(){return this.messageQueue}onClose(t){this.closeCallback=t}sendMessage(t){t=this.upgrader.downgrade(t),this.internalSocket.send(this.formatter.encodeMessage(t))}onOpen(t){this.openCallback=t,this.internalSocket.state===1&&this.openCallback()}errors(){return this.errorQueue}get socket(){return this.internalSocket}installSocketHandler(){this.internalSocket.setOpenListener(()=>this.openListener()),this.internalSocket.setDataListener(t=>this.receiveData(t)),this.internalSocket.setCloseListener((t,s)=>this.closeListener(t,s)),this.internalSocket.setErrorListener(t=>this.errorQueue.push(new N(t)))}};var z=class o extends g{constructor(){super(...arguments);this.pingTimeoutMs=6*1e3}static fromAddress(s){let a=new L,i=a.protocol+g.EMULATED_PING_SUBPROTOCOL,l=Q.fromAddress(s,{protocol:i}),p=new o(new _({socket:l,formatter:a}));return p.registerPingHandler(),p}setUrlProvider(s){this.transport.socket.setUrlProvider(s)}setLostConnectionHandler(s){this._lostConnectionHandler=s}setReconnectHandler(s){this._reconnectHandler=s}setBeforeReconnectAttemptListener(s){this.beforeReconnectAttemptHandler=s}reconnect(){this.transport.socket.open()}updateInternalTransport(s){super.updateInternalTransport(s),this.transport.socket.setLostConnectionListener(()=>this._onLostConnection()),this.transport.socket.setReconnectedListener(()=>this._onReconnect()),this.transport.socket.setBeforeReconnectAttemptListener(()=>this.onBeforeReconnectAttempt())}_onLostConnection(){this._lostConnectionHandler&&this._lostConnectionHandler()}_onReconnect(){this._reconnectHandler&&this._reconnectHandler()}onBeforeReconnectAttempt(){this.beforeReconnectAttemptHandler&&this.beforeReconnectAttemptHandler()}registerPingHandler(){this.addRequestHandler("core.PingRequest",()=>(this.pingTimeout&&(clearTimeout(this.pingTimeout),this.pingTimeout=void 0),this.pingTimeout=setTimeout(()=>this.transport.socket.timeout(),this.pingTimeoutMs),{})),this.addRequestHandler("core.TimestampRequest",()=>({timestamp:new Date}))}};return we(Ve);})();
